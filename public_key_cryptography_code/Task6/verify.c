#include <stdio.h>
#include <openssl/bn.h>

#define NBITS 512 

void printBN(char *msg, BIGNUM * a)
{
   char * number_str = BN_bn2hex(a);
   printf("%s %s\n", msg, number_str);
   OPENSSL_free(number_str);
}

int main ()
{
  BN_CTX *ctx = BN_CTX_new();

  BIGNUM *n, *e, *s, *m;
  n = BN_new(); e = BN_new();
  s = BN_new(); m = BN_new();
 

  // Set the public key exponent e
  BN_dec2bn(&e, "65537");
  // Set the public key n
  BN_hex2bn(&n, "9C1BF1BB2F7F6318155151540F9EC54E4D1058FA309B172990E6330CAC13537C5491B4EAD86E9B896DBB333E8FD20DA6E9F9BAE90D0C1A9EB28EC9702EEF1E057D95EB2D8DA2A94DB39CE7F31936BBA7F17CE6081E6127447A96F4A834DBE242C8A5DB37D5B5E7E442723FB413CF8B0724451E8C918346B909A6FC18A30602EC348D32669527EAE197E8DB35A32B56EB57E8F01059DF6D700C666AD064E5A8A39831AD1D62D5FA92E39A43CD2D35FBD99E335B457DC486282C6612C8DB0F19300D3FE9F0EA4A5E4007C7F6207A537881647A7E456A166FF49358C962FB29277DA17F21CEE74F47D68A56E0E366F8ECDD89DC268C19683B8D8BE2FB47230B7F37");
 
  // Verify sign: calculate s^e mod n to get the message
  BN_hex2bn(&s, "49e7ac2ec66e1f96b7daf4d631828fbf84ff878e0db63840bc61c3486d888205e9e50d1dc1a2257ca90b643cc05493345bb768766f32d2c89cd13da3ce33883b6169b5ffaa4576a1b9d9dd95e5fb63ba355bef4731e5b1d6cf42e229d96619f1d949341493ee46aed76bf5236a97374482099cb4715d6ade9959bf83ad79f241b357fbe22d4f1fdd4c1b898c28b1b4ce377b5fe5b80bf59d2712b80979cd4eae1f3813d043f53c9dd6b894a3d438b1d4db1b2563969a7116e4be1286e95072b368733439e9fc25a853620dde94a92afee85189b2f57d8866e60faa43eefcca21fbcdf12a05d059e54c8abd9d117607ee9699820df02a6576e671748c17490fe7");    
  BN_mod_exp(m, s, e, n, ctx);
  printBN("Verifying result:", m);
  

  // Clear the sensitive data from the memory             
  BN_clear_free(m); BN_clear_free(s);

  return 0;
}

